# Debug API

Debug API предназначен для удалённой отладки. По умолчанию **выключен**. Включается через тоггл в **Settings → Debug API**.

Пока debug API выключен, все эндпоинты возвращают `403 Forbidden`.

---

## Эндпоинты

### `GET /api/debug/dump`

Полный дамп всех данных приложения.

**Ответ:**

| Поле | Тип | Описание |
|------|-----|----------|
| `settings` | object | Все настройки приложения |
| `subscriptions` | array | Подписки с нодами, трафиком, датами |
| `manual_nodes` | array | Вручную добавленные ноды |
| `filters` | array | Фильтры нод |
| `rules` | array | Кастомные правила маршрутизации |
| `rule_groups` | array | Группы правил (Ad Block, AI Services и т.д.) |
| `country_groups` | array | Группировка нод по странам |
| `unsupported_nodes` | array | Ноды, не прошедшие валидацию |
| `service` | object | Статус sing-box (running, pid) |
| `runtime` | object | Информация о среде выполнения |
| `timestamp` | string | UTC timestamp ответа |

**`runtime` содержит:**
- `version` — версия sbm
- `go_version` — версия Go
- `os`, `arch` — ОС и архитектура
- `goroutines` — количество горутин
- `mem_alloc_mb` — выделенная память (MB)
- `mem_sys_mb` — системная память (MB)

**Пример:**

```bash
curl http://<host>:9090/api/debug/dump | jq .
```

---

### `GET /api/debug/logs/singbox`

Логи sing-box.

**Параметры:**

| Параметр | Тип | По умолчанию | Макс | Описание |
|----------|-----|-------------|------|----------|
| `lines` | int | 500 | 5000 | Количество строк |

**Пример:**

```bash
curl "http://<host>:9090/api/debug/logs/singbox?lines=1000" | jq .
```

---

### `GET /api/debug/logs/app`

Логи приложения sbm.

**Параметры:**

| Параметр | Тип | По умолчанию | Макс | Описание |
|----------|-----|-------------|------|----------|
| `lines` | int | 500 | 5000 | Количество строк |

**Пример:**

```bash
curl "http://<host>:9090/api/debug/logs/app?lines=1000" | jq .
```

---

## Включение

1. Открыть веб-интерфейс → **Settings**
2. Найти секцию **Debug API**
3. Включить тоггл **Enable Debug API**
4. Нажать **Save**

После включения на странице отображается предупреждение с полным URL для доступа.

## Безопасность

- Debug API отдаёт **все** данные приложения, включая пароли и URL подписок
- Рекомендуется включать только на время отладки
- Если `allow_lan` выключен, доступ возможен только с localhost
